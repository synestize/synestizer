(function () {
"use strict";
window.WX={_VERSION:"1.0.0-alpha3"};var _webkitAC=window.hasOwnProperty("webkitAudioContext"),_AC=window.hasOwnProperty("AudioContext");if(!_webkitAC&&!_AC)throw new Error("Error: Web Audio API is not supported on your browser.");_webkitAC&&!_AC&&(window.AudioContext=window.webkitAudioContext),WX._ctx=new AudioContext;for(var _dependency=[],i=0;i<_dependency.length;i++)if("undefined"==typeof WX._ctx[_dependency[i]]){var message='Error: "'+_dependency+'" is not supported in AudioContext.';throw new Error(message)}
AudioNode.prototype.to=function(){for(var i=0;i<arguments.length;i++)this.connect(arguments[i]);return arguments[0]},AudioNode.prototype.cut=function(){this.disconnect()},AudioParam.prototype.cancel=AudioParam.prototype.cancelScheduledValues,AudioParam.prototype.set=function(value,time,rampType){var now=WX.now;switch(rampType){case 0:case void 0:time=now>time?now:time,this.setValueAtTime(value,time),now>=time&&value!==this.value&&(this.value=value);break;case 1:time=now>time?now:time,this.linearRampToValueAtTime(value,time);break;case 2:time=now>time?now:time,value=0>=value?1e-5:value,this.exponentialRampToValueAtTime(value,time);break;case 3:time[0]=time[0]<now?now:time[0],value=0>=value?1e-5:value,this.setTargetAtTime(value,time[0],time[1])}},Object.defineProperties(WX,{now:{get:function(){return WX._ctx.currentTime}},srate:{get:function(){return WX._ctx.sampleRate}}}),WX.Gain=function(){return WX._ctx.createGain()},WX.OSC=function(){return WX._ctx.createOscillator()},WX.Delay=function(){return WX._ctx.createDelay()},WX.Filter=function(){return WX._ctx.createBiquadFilter()},WX.Comp=function(){return WX._ctx.createDynamicsCompressor()},WX.Convolver=function(){return WX._ctx.createConvolver()},WX.WaveShaper=function(){return WX._ctx.createWaveShaper()},WX.Source=function(){return WX._ctx.createBufferSource()},WX.Analyzer=function(){return WX._ctx.createAnalyser()},WX.Panner=function(){return WX._ctx.createPanner()},WX.PeriodicWave=function(){return WX._ctx.createPeriodicWave.apply(WX._ctx,arguments)},WX.Splitter=function(){return WX._ctx.createChannelSplitter.apply(WX._ctx,arguments)},WX.Merger=function(){return WX._ctx.createChannelMerger.apply(WX._ctx,arguments)},WX.Buffer=function(){return WX._ctx.createBuffer.apply(WX._ctx,arguments)},WX.WAVEFORMS=[{key:"Sine",value:"sine"},{key:"Square",value:"square"},{key:"Sawtooth",value:"sawtooth"},{key:"Triangle",value:"triangle"}],WX.FILTER_TYPES=[{key:"LP",value:"lowpass"},{key:"HP",value:"highpass"},{key:"BP",value:"bandpass"},{key:"LS",value:"lowshelf"},{key:"HS",value:"highshelf"},{key:"PK",value:"peaking"},{key:"BR",value:"notch"},{key:"AP",value:"allpass"}];
WX.Log={_LEVEL:1},WX.Log.setLevel=function(level){this._LEVEL=level},WX.Log.info=function(){if(!(this._LEVEL>1)){var args=Array.prototype.slice.call(arguments);args.unshift("[WX:info]"),window.console.log.apply(window.console,args)}},WX.Log.warn=function(){if(!(this._LEVEL>2)){var args=Array.prototype.slice.call(arguments);args.unshift("[WX:warn]"),window.console.log.apply(window.console,args)}},WX.Log.error=function(){var args=Array.prototype.slice.call(arguments);throw args.unshift("[WX:error]"),window.console.log.apply(window.console,args),new Error("[WX:error]")},WX.getVersion=function(){return this._VERSION},WX.isObject=function(obj){return obj===Object(obj)},WX.isFunction=function(fn){return"[object Function]"===toString.call(fn)},WX.isArray=function(arr){return"[object Array]"===toString.call(arr)},WX.isNumber=function(num){return"[object Number]"===toString.call(num)},WX.isBoolean=function(bool){return"[object Boolean]"===toString.call(bool)},WX.hasParam=function(plugin,param){return hasOwnProperty.call(plugin.params,param)},WX.extend=function(target,source){for(var prop in source)target[prop]=source[prop];return target},WX.clone=function(source){var obj={};for(var prop in source)obj[prop]=source[prop];return obj},WX.validateModel=function(model){if(0===model.length)return!1;for(var keys=[],i=0;i<model.length;i++){if(keys.indexOf(model[i].key)>-1)return!1;keys.push(model[i].key)}return!0},WX.findKeyByValue=function(model,value){for(var i=0;i<model.length;i++)if(model[i].value===value)return model[i].key;return null},WX.findValueByKey=function(model,key){for(var i=0;i<model.length;i++)if(model[i].key===key)return model[i].value;return null},WX.clamp=function(value,min,max){return Math.min(Math.max(value,min),max)},WX.random2f=function(min,max){return min+Math.random()*(max-min)},WX.random2=function(min,max){return Math.round(min+Math.random()*(max-min))},WX.mtof=function(midi){return-1500>=midi?0:midi>1499?3.282417553401589e38:440*Math.pow(2,(Math.floor(midi)-69)/12)},WX.ftom=function(freq){return Math.floor(freq>0?Math.log(freq/440)/Math.LN2*12+69:-1500)},WX.powtodb=function(power){if(0>=power)return 0;var db=100+10/Math.LN10*Math.log(power);return 0>db?0:db},WX.dbtopow=function(db){return 0>=db?0:(db>870&&(db=870),Math.exp(.1*Math.LN10*(db-100)))},WX.rmstodb=function(rms){if(0>=rms)return 0;var db=100+20/Math.LN10*Math.log(rms);return 0>db?0:db},WX.dbtorms=function(db){return 0>=db?0:(db>485&&(db=485),Math.exp(.05*Math.LN10*(db-100)))},WX.lintodb=function(lin){return 20*(lin>1e-5?Math.log(lin)/Math.LN10:-5)},WX.dbtolin=function(db){return Math.pow(10,db/20)},WX.veltoamp=function(velocity){return velocity/127},WX.loadClip=function(clip,oncomplete,onprogress){if(!oncomplete)return void WX.Log.error("Specify `oncomplete` action.");var xhr=new XMLHttpRequest;xhr.open("GET",clip.url,!0),xhr.responseType="arraybuffer",xhr.onprogress=function(event){onprogress&&onprogress(event,clip)},xhr.onload=function(){try{WX._ctx.decodeAudioData(xhr.response,function(buffer){clip.buffer=buffer,oncomplete(clip)})}catch(error){WX.Log.error("Loading clip failed. (XHR failure)",error.message,clip.url)}},xhr.send()};
function wxparam_checkNumeric(arg,defaultValue){return WX.isNumber(arg)?arg:void 0===arg?defaultValue:void WX.Log.error("Invalid parameter configuration.")}function wxparam_create(options){switch(PARAM_TYPES.indexOf(options.type)<0&&WX.Log.error("Invalid Parameter Type."),options.type){case"Generic":return new GenericParam(options);case"Itemized":return new ItemizedParam(options);case"Boolean":return new BooleanParam(options)}}function GenericParam(options){this.init(options)}function ItemizedParam(options){this.init(options)}function BooleanParam(options){this.init(options)}function PlugInAbstract(){this.params={}}function Generator(){PlugInAbstract.call(this),this._output=WX.Gain(),this._outlet=WX.Gain(),this._output.to(this._outlet),WX.defineParams(this,{output:{type:"Generic",name:"Output","default":1,min:0,max:1,unit:"LinearGain"}})}function Processor(){PlugInAbstract.call(this),this._inlet=WX.Gain(),this._input=WX.Gain(),this._output=WX.Gain(),this._active=WX.Gain(),this._bypass=WX.Gain(),this._outlet=WX.Gain(),this._inlet.to(this._input,this._bypass),this._output.to(this._active).to(this._outlet),this._bypass.to(this._outlet),this._active.gain.value=1,this._bypass.gain.value=0,WX.defineParams(this,{input:{type:"Generic",name:"Input","default":1,min:0,max:1,unit:"LinearGain"},output:{type:"Generic",name:"Output","default":1,min:0,max:1,unit:"LinearGain"},bypass:{type:"Boolean",name:"Bypass","default":!1}})}function Analyzer(){PlugInAbstract.call(this),this._inlet=WX.Gain(),this._input=WX.Gain(),this._analyzer=WX.Analyzer(),this._outlet=WX.Gain(),this._inlet.to(this._input).to(this._analyzer),this._inlet.to(this._outlet),WX.defineParams(this,{input:{type:"Generic",name:"Input","default":1,min:0,max:1,unit:"LinearGain"}})}var PARAM_TYPES=["Generic","Itemized","Boolean"],PARAM_UNITS=["","Octave","Semitone","Seconds","Milliseconds","Samples","Hertz","Cents","Decibels","LinearGain","Percent","BPM"];GenericParam.prototype={init:function(options){this.type="Generic",this.name=options.name||"Parameter",this.unit=options.unit||"",this.value=this.default=wxparam_checkNumeric(options.default,0),this.min=wxparam_checkNumeric(options.min,0),this.max=wxparam_checkNumeric(options.max,1),this._parent=options._parent,this.$callback=options._parent["$"+options._paramId]},set:function(value,time,rampType){this.value=WX.clamp(value,this.min,this.max),this.$callback&&this.$callback.call(this._parent,this.value,time,rampType)},get:function(){return this.value}},ItemizedParam.prototype={init:function(options){WX.isArray(options.model)||Log.error("Model is missing."),WX.validateModel(options.model)||Log.error("Invalid Model."),this.type="Itemized",this.name=options.name||"Select",this.model=options.model,this.default=options.default||this.model[0].value,this.value=this.default,this._parent=options._parent,this.$callback=options._parent["$"+options._paramId]},set:function(value,time,rampType){WX.findKeyByValue(this.model,value)?(this.value=value,this.$callback&&this.$callback.call(this._parent,this.value,time,rampType)):WX.Log.warn("Invalid value (value not found in model).")},get:function(){return this.value},getModel:function(){return this.model}},BooleanParam.prototype={init:function(options){WX.isBoolean(options.default)||Log.error("Invalid value for Boolean Parameter."),this.type="Boolean",this.name=options.name||"Toggle",this.value=this.default=options.default,this._parent=options._parent,this.$callback=options._parent["$"+options._paramId]},set:function(value,time,rampType){WX.isBoolean(value)&&(this.value=value,this.$callback&&this.$callback.call(this._parent,this.value,time,rampType))},get:function(){return this.value}},WX.defineParams=function(plugin,paramOptions){for(var key in paramOptions)paramOptions[key]._parent=plugin,paramOptions[key]._paramId=key,plugin.params[key]=wxparam_create(paramOptions[key])},WX.Envelope=function(){var args=arguments;return function(startTime,amplifier){var env=[];startTime=startTime||0,amplifier=amplifier||1;for(var i=0;i<args.length;i++){var time,val=args[i][0];WX.isArray(args[i][1])?(time=[startTime+args[i][1][0],startTime+args[i][1][1]],env.push([val*amplifier,time,3])):(time=startTime+args[i][1],env.push([val*amplifier,time,args[i][2]||0]))}return env}};var PLUGIN_TYPES=["Generator","Processor","Analyzer"],registered={Generator:[],Processor:[],Analyzer:[]};PlugInAbstract.prototype={to:function(target){if(target._inlet)return this._outlet.to(target._inlet),target;try{return this._outlet.to(target),target}catch(error){WX.Log.error("Connection failed. Invalid patching.")}},cut:function(){this._outlet.cut()},set:function(param,arg){if(WX.hasParam(this,param))if(WX.isArray(arg))for(var i=0;i<arg.length;i++)this.params[param].set.apply(this,arg[i]);else this.params[param].set(arg,WX.now,0);return this},get:function(param){return WX.hasParam(this,param)?this.params[param].get():null},setPreset:function(preset){for(var param in preset)this.params[param].set(preset[param],WX.now,0)},getPreset:function(){var preset={};for(var param in this.params)preset[param]=this.params[param].get();return preset}},Generator.prototype={$output:function(value,time,rampType){this._output.gain.set(value,time,rampType)}},WX.extend(Generator.prototype,PlugInAbstract.prototype),Processor.prototype={$input:function(value,time,rampType){this._input.gain.set(value,time,rampType)},$output:function(value,time,rampType){this._output.gain.set(value,time,rampType)},$bypass:function(value,time){time=time||WX.now,value?(this._active.gain.set(0,time,0),this._bypass.gain.set(1,time,0)):(this._active.gain.set(1,time,0),this._bypass.gain.set(0,time,0))}},WX.extend(Processor.prototype,Generator.prototype),Analyzer.prototype={$input:function(value,time,xtype){this._input.gain.set(value,time,xtype)}},WX.extend(Analyzer.prototype,PlugInAbstract.prototype),WX.PlugIn={},WX.PlugIn.defineType=function(plugin,type){switch(PLUGIN_TYPES.indexOf(type)<0&&WX.Log.error("Invalid Plug-in type."),type){case"Generator":Generator.call(plugin);break;case"Processor":Processor.call(plugin);break;case"Analyzer":Analyzer.call(plugin)}},WX.PlugIn.initPreset=function(plugin,preset){var merged=WX.clone(plugin.defaultPreset);WX.extend(merged,preset),plugin.setPreset(merged)},WX.PlugIn.extendPrototype=function(plugin,type){switch(PLUGIN_TYPES.indexOf(type)<0&&WX.Log.error("Invalid Plug-in type."),type){case"Generator":WX.extend(plugin.prototype,Generator.prototype);break;case"Processor":WX.extend(plugin.prototype,Processor.prototype);break;case"Analyzer":WX.extend(plugin.prototype,Analyzer.prototype)}},WX.PlugIn.register=function(PlugInClass){var info=PlugInClass.prototype.info;WX.getVersion()<info.api_version&&WX.Log.error(PlugInClass.name,": FATAL. incompatible WAAX version."),registered[info.type].push(PlugInClass.name),WX[PlugInClass.name]=function(preset){return new PlugInClass(preset)}},WX.PlugIn.getRegistered=function(type){var plugins=null;if(PLUGIN_TYPES.indexOf(type)>-1)switch(type){case void 0:plugins=registered.Generator.slice(0),plugins=plugins.concat(registered.Processor.slice(0)),plugins=plugins.concat(registered.Analyzer.slice(0));break;case"Generator":plugins=registered.Generator.slice(0);break;case"Processor":plugins=registered.Processor.slice(0);break;case"Analyzer":plugins=registered.Analyzer.slice(0)}return plugins},WX.Log.info("WAAX",WX.getVersion(),"("+WX.srate+"Hz)");
function generate_uid4(){var t=Date.now(),id="xxxx".replace(/[x]/g,function(c){var r=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"==c?r:7&r|8).toString(16)});return id}function Note(pitch,velocity,start,duration){this.pitch=pitch||60,this.velocity=velocity||100,this.start=start||0,this.duration=duration||120}function NoteClip(){this._init()}function Transport(BPM){this._init(BPM||120)}var _TICKS_PER_BEAT=480,_TICKS_PER_MEASURE=4*_TICKS_PER_BEAT,_TICKS_PER_SIXTEENTH=.25*_TICKS_PER_BEAT;Note.prototype={changeDuration:function(delta){this.duration+=~~delta,this.duration=Math.max(this.duration,1)},getEnd:function(){return this.start+this.duration},setNote:function(note){for(var prop in note)this[prop]=note[prop]},translatePitch:function(delta){this.pitch+=~~delta,this.pitch=WX.clamp(this.pitch,0,127)},translateStart:function(delta){this.start+=~~delta,this.start=Math.max(this.start,0)},toString:function(){return this.pitch+","+this.velocity+","+this.start+","+this.duration},valueOf:function(){return this.start}},NoteClip.prototype={_init:function(){this.notes={},this.start=0,this.end=0,this.size=0},"delete":function(id){if(this.notes.hasOwnProperty(id)){var note=this.notes[id];return delete this.notes[id],this.size--,note}return null},empty:function(){this.notes={},this.size=0},findNoteIdAtPosition:function(pitch,tick){for(var id in this.notes){var note=this.notes[id];if(note&&note.pitch===pitch&&note.start<=tick&&tick<=note.getEnd())return id}return null},findNotesIdInArea:function(minPitch,maxPitch,startTick,endTick){var bucket=[];for(var id in this.notes){var note=this.notes[id];note&&minPitch<=note.pitch&&note.pitch<=maxPitch&&startTick<=note.start&&note.start<=endTick&&bucket.push(id)}return bucket.length>0?bucket:null},get:function(id){return this.hasId(id)?this.notes[id]:null},getAllId:function(){return Object.keys(this.notes)},getSize:function(){return this.size},hasId:function(id){return this.notes.hasOwnProperty(id)},iterate:function(callback){var index=0;for(var id in this.notes)callback(id,this.notes[id],index++)},push:function(note){var id;do id=generate_uid4();while(this.hasId(id));return this.notes[id]=note,this.size++,id},set:function(id,note){this.hasId(id)?this.notes[id].setNote(note):this.notes[id]=note},scanNotesInTimeSpan:function(start,end){var bucket=[];for(var id in this.notes){var note=this.notes[id];note&&start<=note.start&&note.start<=end&&bucket.push(note)}return bucket.length>0?bucket:null}},Transport.prototype={_flushPlaybackQueue:function(){this._playbackQueue.length=0},_setPlayheadPosition:function(second){this._now=second,this._absOrigin=WX.now-this._now},_scheduleNotesInScanRange:function(){if(this._needsScan){var notes=null;if(this._source&&(notes=this._source.scanNotesInTimeSpan(this.sec2tick(this._scanStart),this.sec2tick(this._scanEnd))),notes)for(var i=0;i<notes.length;i++)this._playbackQueue.indexOf(notes[i])<0&&this._playbackQueue.push(notes[i]);this._needsScan=!1}if(this._playbackQueue.length>0)for(var i=0;i<this._playbackQueue.length;i++){var note=this._playbackQueue[i],start=this._absOrigin+this.tick2sec(note.start);start+this.tick2sec(note.dur)}},_advanceScanRange:function(){this._scanEnd-this._now<.0167&&(this._scanStart=this._scanEnd,this._scanEnd=this._scanStart+this._lookAhead,this._needsScan=!0)},_resetScanRange:function(){this._scanStart=this._now,this._scanEnd=this._scanStart+this._lookahead,this._needsScan=!0},_updateView:function(){},_run:function(){if(this._RUNNING){var absNow=WX.now;this._now+=absNow-this._absLastNow,this._absLastNow=absNow,this._scheduleNotesInScanRange(),this._advanceScanRange(),this._updateView(),this._flushPlaybackQueue(),this._LOOP&&this._loopEnd-(this._now+this._lookAhead)<0&&this._setPlayheadPosition(this._loopStart-(this._loopEnd-this._now))}requestAnimationFrame(this._run.bind(this))},_init:function(BPM){this._BPM=BPM,this._lastBPM=BPM,this._BIS=0,this._TIS=0,this._absOrigin=0,this._absLastNow=0,this._now=0,this._loopStart=0,this._loopEnd=0,this._lookAhead=0,this._scanStart=0,this._scanEnd=this._lookAhead,this._needsScan=!0,this._transportView=null,this._playbackQueue=[],this._source=null,this._target=null,this._RUNNING=!1,this._LOOP=!1,this._USE_METRONOME=!1,this.setBPM(BPM),this._run()},tick2sec:function(tick){return tick*this._TIS},sec2tick:function(sec){return sec/this._TIS},start:function(){var absNow=WX.now;this._absOrigin=absNow-this._now,this._absLastNow=absNow,this._resetScanRange(),this._RUNNING=!0},pause:function(){this._RUNNING=!1,this._flushPlaybackQueue()},setNow:function(tick){this._setPlayheadPosition(this.tick2sec(tick)),this._resetScanRange()},getNow:function(){return this.sec2tick(this._now)},rewind:function(){this._setPlayheadPosition(0)},setLoopStart:function(tick){this._loopStart=this.tick2sec(tick)},setLoopEnd:function(tick){this._loopEnd=this.tick2sec(tick)},getLoopStart:function(){return this.sec2tick(this._loopStart)},getLoopEnd:function(){return this.sec2tick(this._loopEnd)},toggleLoop:function(bool){void 0===bool?this._LOOP=!this._LOOP:WX.isBoolean(bool)?this._LOOP=bool:WX.Log.error("Invalid parameter. Use boolean value.")},setBPM:function(BPM){this._BPM=BPM||120;var factor=this._lastBPM/this._BPM;this._lastBPM=this._BPM,this._BIS=60/this._BPM,this._TIS=this._BIS/_TICKS_PER_BEAT,this._lookAhead=16*this._TIS,this._now*=factor,this._loopStart*=factor,this._loopEnd*=factor,this._absOrigin=WX.now-this._now},getBPM:function(){return this._BPM},isRunning:function(){return this._RUNNING}},WX.mbst2tick=function(mtime){return(mtime.measure||0)*_TICKS_PER_MEASURE+(mtime.beat||0)*_TICKS_PER_BEAT+(mtime.sixteenth||0)*_TICKS_PER_SIXTEENTH+(mtime.tick||0)},WX.tick2mbst=function(tick){return{measure:~~(tick/_TICKS_PER_MEASURE),beat:~~(tick%_TICKS_PER_MEASURE/_TICKS_PER_BEAT),sixteenth:~~(tick%_TICKS_PER_BEAT/_TICKS_PER_SIXTEENTH),tick:~~(tick%_TICKS_PER_SIXTEENTH)}},WX.Note=function(pitch,velocity,start,duration){return new Note(pitch,velocity,start,duration)},WX.NoteClip=function(){return new NoteClip},WX.Transport=new Transport(120);
function MouseResponder(senderID,targetElement,MUICallback){this.senderId=senderID,this.container=targetElement,this.callback=MUICallback,this.ondragged=this.dragged.bind(this),this.onreleased=this.released.bind(this),this._prevTS=0,this.onclicked(targetElement)}function KeyResponder(senderID,targetElement,MUICallback){this.senderId=senderID,this.container=targetElement,this.callback=MUICallback,this.onkeypress=this.keypressed.bind(this),this.onblur=this.finished.bind(this),this.onfocus(targetElement)}window.MUI={},MouseResponder.prototype={getEventData:function(event){var r=this.container.getBoundingClientRect();return{x:event.clientX-r.left,y:event.clientY-r.top,ctrlKey:event.ctrlKey,altKey:event.altKey,shiftKey:event.shiftKey,metaKey:event.metaKey}},onclicked:function(target){target.addEventListener("mousedown",function(event){event.preventDefault(),this._prevTS=event.timeStamp;var p=this.getEventData(event);this.callback(this.senderId,"clicked",p),window.addEventListener("mousemove",this.ondragged,!1),window.addEventListener("mouseup",this.onreleased,!1)}.bind(this),!1)},dragged:function(event){if(event.preventDefault(),!(event.timeStamp-this._prevTS<16.7)){this._prevTS=event.timeStamp;var p=this.getEventData(event);this.callback(this.senderId,"dragged",p)}},released:function(event){event.preventDefault();var p=this.getEventData(event);this.callback(this.senderId,"released",p),window.removeEventListener("mousemove",this.ondragged,!1),window.removeEventListener("mouseup",this.onreleased,!1)}},KeyResponder.prototype={onfocus:function(){this.container.addEventListener("mousedown",function(){this.callback(this.senderId,"clicked",null),this.container.addEventListener("keypress",this.onkeypress,!1),this.container.addEventListener("blur",this.onblur,!1)}.bind(this),!1)},keypressed:function(event){this.callback(this.senderId,"keypressed",event.keyCode)},finished:function(){this.callback(this.senderId,"finished",null),this.container.removeEventListener("keypress",this.onkeypress,!1),this.container.removeEventListener("blur",this.onblur,!1)}},MUI.$=function(elementId){return document.getElementById(elementId)},MUI.start=function(onreadyFn){WX.isObject(window.Platform)?window.addEventListener("polymer-ready",onreadyFn):WX.Log.error("FATAL: WebComponentPolyfill/Polymer is not loaded.")},MUI.isPointInArea=function(point,area){return area.x<=point.x&&point.x<=area.x+area.w&&area.y<=point.y&&point.y<=area.y+area.h},MUI.buildControls=function(plugin,targetId){var targetEl=document.getElementById(targetId);targetEl.label=plugin.info.name;for(var param in plugin.params){var p=plugin.params[param];switch(p.type){case"Generic":var knob=document.createElement("mui-knob");knob.link(plugin,param),targetEl.appendChild(knob);break;case"Itemized":var select=document.createElement("mui-select");select.link(plugin,param),targetEl.appendChild(select);break;case"Boolean":var button=document.createElement("mui-button");button.type="toggle",button.link(plugin,param),targetEl.appendChild(button)}}},MUI.removeChildren=function(targetId){for(var targetEl=document.getElementById(targetId);targetEl.firstChild;)targetEl.removeChild(targetEl.firstChild)},MUI.MouseResponder=function(senderID,targetElement,MUICallback){return new MouseResponder(senderID,targetElement,MUICallback)},MUI.KeyResponder=function(senderID,targetElement,MUICallback){return new KeyResponder(senderID,targetElement,MUICallback)};
})();
!function(WX){"use strict";function CMP1(preset){WX.PlugIn.defineType(this,"Processor"),this._comp=WX.Comp(),this._makeup=WX.Gain(),this._input.to(this._comp).to(this._makeup).to(this._output),WX.defineParams(this,{threshold:{type:"Generic",name:"Threshold","default":-8,min:-60,max:0,unit:"Decibels"},knee:{type:"Generic",name:"Knee","default":20,min:0,max:40,unit:"Decibels"},ratio:{type:"Generic",name:"Ratio","default":4,min:1,max:20},attack:{type:"Generic",name:"Attack","default":.025,min:0,max:1,unit:"Seconds"},release:{type:"Generic",name:"Release","default":.25,min:0,max:1,unit:"Seconds"},makeup:{type:"Generic",name:"Makeup","default":0,min:0,max:24,unit:"Decibels"}}),WX.PlugIn.initPreset(this,preset)}CMP1.prototype={info:{name:"CMP1",version:"0.0.1",api_version:"1.0.0-alpha",author:"Hongchan Choi",type:"Processor",description:"Basic compressor"},defaultPreset:{threshold:-8,knee:20,ratio:4,attack:.025,release:.25,makeup:0},$threshold:function(value,time,rampType){this._comp.threshold.set(value,time,rampType)},$knee:function(value,time,rampType){this._comp.knee.set(value,time,rampType)},$ratio:function(value,time,rampType){this._comp.ratio.set(value,time,rampType)},$attack:function(value,time,rampType){this._comp.attack.set(value,time,rampType)},$release:function(value,time,rampType){this._comp.release.set(value,time,rampType)},$makeup:function(value,time,rampType){this._makeup.gain.set(WX.dbtolin(value),time,rampType)}},WX.PlugIn.extendPrototype(CMP1,"Processor"),WX.PlugIn.register(CMP1)}(WX);
!function(WX){"use strict";function Chorus(preset){WX.PlugIn.defineType(this,"Processor"),this._dry=WX.Gain(),this._wet=WX.Gain();var _splitter=WX.Splitter(2),_merger=WX.Merger(2);this._LStream=WX.Gain(),this._LDelayVibrato=WX.Delay(),this._LDelayFixed=WX.Delay(),this._LFeedback=WX.Gain(),this._LFeedforward=WX.Gain(),this._LBlend=WX.Gain(),this._RStream=WX.Gain(),this._RDelayVibrato=WX.Delay(),this._RDelayFixed=WX.Delay(),this._RFeedback=WX.Gain(),this._RFeedforward=WX.Gain(),this._RBlend=WX.Gain(),this._input.to(_splitter,this._dry),_splitter.connect(this._LStream,0,0),this._LStream.to(this._LDelayVibrato),this._LStream.to(this._LDelayFixed),this._LDelayVibrato.to(this._LFeedforward),this._LDelayVibrato.connect(_merger,0,0),this._LDelayFixed.to(this._LFeedback),this._LFeedback.to(this._LStream),this._LBlend.connect(_merger,0,0),_splitter.connect(this._RStream,1,0),this._RStream.to(this._RDelayVibrato),this._RStream.to(this._RDelayFixed),this._RDelayVibrato.to(this._RFeedforward),this._RDelayVibrato.connect(_merger,0,1),this._RDelayFixed.to(this._RFeedback),this._RFeedback.to(this._RStream),this._RBlend.connect(_merger,0,1),_merger.to(this._wet),this._dry.to(this._output),this._wet.to(this._output),this._lfo=WX.OSC(),this._LDepth=WX.Gain(),this._RDepth=WX.Gain(),this._lfo.to(this._LDepth,this._RDepth),this._LDepth.to(this._LDelayVibrato.delayTime),this._RDepth.to(this._RDelayVibrato.delayTime),this._lfo.start(0),this._lfo.type="sine",this._lfo.frequency.value=.15,this._LDepth.gain.value=.013,this._RDepth.gain.value=-.017,this._LDelayVibrato.delayTime.value=.013,this._LDelayFixed.delayTime.value=.005,this._RDelayVibrato.delayTime.value=.017,this._RDelayFixed.delayTime.value=.007,WX.defineParams(this,{rate:{type:"Generic",name:"Rate","default":.1,min:.1,max:1,unit:"Hertz"},intensity:{type:"Generic",name:"Intensity","default":.1,min:.01,max:1},mix:{type:"Generic",name:"Mix","default":.6,min:0,max:1}}),WX.PlugIn.initPreset(this,preset)}Chorus.prototype={info:{name:"Chorus",version:"0.0.1",api_version:"1.0.0-alpha",author:"Hongchan Choi",type:"Processor",description:"Basic chorus effect"},defaultPreset:{rate:.5,intensity:0,mix:.75},$rate:function(value,time,rampType){value=.29*WX.clamp(value,0,1)+.01,this._lfo.frequency.set(value,time,rampType)},$intensity:function(value,time,rampType){value=WX.clamp(value,0,1);var blend=1-.2929*value,feedforward=.2929*value+.7071,feedback=.7071*value;this._LBlend.gain.set(blend,time,rampType),this._RBlend.gain.set(blend,time,rampType),this._LFeedforward.gain.set(feedforward,time,rampType),this._RFeedforward.gain.set(feedforward,time,rampType),this._LFeedback.gain.set(feedback,time,rampType),this._RFeedback.gain.set(feedback,time,rampType)},$mix:function(value,time,rampType){this._dry.gain.set(1-value,time,rampType),this._dry.gain.set(value,time,rampType)}},WX.PlugIn.extendPrototype(Chorus,"Processor"),WX.PlugIn.register(Chorus)}(WX);
!function(WX){"use strict";function ConVerb(preset){WX.PlugIn.defineType(this,"Processor"),this.ready=!1,this.clip=null,this._dry=WX.Gain(),this._wet=WX.Gain(),this._convolver=WX.Convolver(),this._input.to(this._dry,this._convolver),this._convolver.to(this._wet),this._dry.to(this._output),this._wet.to(this._output),WX.defineParams(this,{mix:{type:"Generic",name:"Mix","default":.2,min:0,max:1}}),WX.PlugIn.initPreset(this,preset)}ConVerb.prototype={info:{name:"ConVerb",version:"0.0.1",api_version:"1.0.0-alpha",author:"Hongchan Choi",type:"Processor",description:"Convolution Reverb"},defaultPreset:{mix:.2},$mix:function(value,time,rampType){this._dry.gain.set(1-value,time,rampType),this._wet.gain.set(value,time,rampType)},_onprogress:function(){},_onloaded:function(clip){this.setClip(clip)},isReady:function(){return this.ready},setClip:function(clip){this.clip=clip,this._convolver.buffer=this.clip.buffer,this.ready=!0},loadClip:function(clip){WX.loadClip(clip,this._onloaded.bind(this),this._onprogress.bind(this))}},WX.PlugIn.extendPrototype(ConVerb,"Processor"),WX.PlugIn.register(ConVerb)}(WX);
!function(WX){"use strict";function UnitFilter(filterType,frequency){this._input=WX.Gain(),this._bypass=WX.Gain(),this._biquad=WX.Filter(),this._input.to(this._biquad),this._bypass.gain.value=0,this._biquad.type=filterType,this._biquad.frequency.value=frequency,this._active=!0}function EQ4(preset){WX.PlugIn.defineType(this,"Processor"),this._band1=new UnitFilter("lowshelf",80),this._band2=new UnitFilter("peaking",500),this._band3=new UnitFilter("peaking",3500),this._band4=new UnitFilter("highshelf",1e4),this._band1.setInput(this._input),this._band1.cascade(this._band2),this._band2.cascade(this._band3),this._band3.cascade(this._band4),this._band4.setOutput(this._output),WX.defineParams(this,{band1Active:{type:"Boolean",name:"On 1","default":!0},band1Type:{type:"Itemized",name:"Type 1","default":"lowshelf",model:WX.FILTER_TYPES},band1Freq:{type:"Generic",name:"Freq 1","default":80,min:10,max:.5*WX.srate,unit:"Hertz"},band1Q:{type:"Generic",name:"Q 1","default":0,min:.01,max:1e3},band1Gain:{type:"Generic",name:"Gain 1","default":0,min:-40,max:40,unit:"Decibels"},band2Active:{type:"Boolean",name:"On 2","default":!0},band2Type:{type:"Itemized",name:"Type 2","default":"peaking",model:WX.FILTER_TYPES},band2Freq:{type:"Generic",name:"Freq 2","default":500,min:10,max:.5*WX.srate,unit:"Hertz"},band2Q:{type:"Generic",name:"Q 2","default":0,min:.01,max:1e3},band2Gain:{type:"Generic",name:"Gain 2","default":0,min:-40,max:40,unit:"Decibels"},band3Active:{type:"Boolean",name:"On 3","default":!0},band3Type:{type:"Itemized",name:"Type 3","default":"peaking",model:WX.FILTER_TYPES},band3Freq:{type:"Generic",name:"Freq 3","default":3500,min:10,max:.5*WX.srate,unit:"Hertz"},band3Q:{type:"Generic",name:"Q 3","default":0,min:.01,max:1e3},band3Gain:{type:"Generic",name:"Gain 3","default":0,min:-40,max:40,unit:"Decibels"},band4Active:{type:"Boolean",name:"On 4","default":!0},band4Type:{type:"Itemized",name:"Type 4","default":"highshelf",model:WX.FILTER_TYPES},band4Freq:{type:"Generic",name:"Freq 4","default":12e3,min:10,max:.5*WX.srate,unit:"Hertz"},band4Q:{type:"Generic",name:"Q 4","default":0,min:.01,max:1e3},band4Gain:{type:"Generic",name:"Gain 4","default":0,min:-40,max:40,unit:"Decibels"}}),WX.PlugIn.initPreset(this,preset)}UnitFilter.prototype={setInput:function(inputNode){inputNode.to(this._input,this._bypass)},setOutput:function(outputNode){this._biquad.to(outputNode),this._bypass.to(outputNode)},cascade:function(unitFilter){this._biquad.to(unitFilter._input,unitFilter._bypass),this._bypass.to(unitFilter._input,unitFilter._bypass)},toggle:function(bool){this._active=bool,this._active?(this._input.gain.value=1,this._bypass.gain.value=0):(this._input.gain.value=0,this._bypass.gain.value=1)},setFilterType:function(filterType){this._biquad.type=filterType},setAll:function(freq,Q,gain,time,rampType){this._biquad.frequency.set(freq,time,rampType),this._biquad.Q.set(Q,time,rampType),this._biquad.gain.set(gain,time,rampType)},setFrequency:function(value,time,rampType){this._biquad.frequency.set(value,time,rampType)},setQ:function(value,time,rampType){this._biquad.Q.set(value,time,rampType)},setGain:function(value,time,rampType){this._biquad.gain.set(value,time,rampType)},getFrequencyResponse:function(canvasWidth){for(var frequencyHz=new Float32Array(canvasWidth),magResponse=new Float32Array(canvasWidth),phaseResponse=new Float32Array(canvasWidth),nyquist=.5*WX.srate,i=0;width>i;++i)frequencyHz[i]=nyquist*Math.pow(2,noctaves*(i/width-1));return filter.getFrequencyResponse(frequencyHz,magResponse,phaseResponse),{freq:frequencyHz,mag:magResponse}}},EQ4.prototype={info:{name:"EQ4",version:"0.0.1",api_version:"1.0.0-alpha",author:"Hongchan Choi",type:"Processor",description:"4-band Parametric Equalizer"},defaultPreset:{band1Active:!0,band1Type:"lowshelf",band1Freq:80,band1Q:0,band1Gain:0,band2Active:!0,band2Type:"peaking",band2Freq:500,band2Q:0,band2Gain:0,band3Active:!0,band3Type:"peaking",band3Freq:3500,band3Q:0,band3Gain:0,band4Active:!0,band4Type:"highshelf",band4Freq:12e3,band4Q:0,band4Gain:0},$band1Active:function(value){this._band1.toggle(value)},$band1Type:function(value){this._band1.setFilterType(value)},$band1Freq:function(value,time,rampType){this._band1.setFrequency(value,time,rampType)},$band1Q:function(value,time,rampType){this._band1.setQ(value,time,rampType)},$band1Gain:function(value,time,rampType){this._band1.setGain(value,time,rampType)},$band2Active:function(value){this._band2.toggle(value)},$band2Type:function(value){this._band2.setFilterType(value)},$band2Freq:function(value,time,rampType){this._band2.setFrequency(value,time,rampType)},$band2Q:function(value,time,rampType){this._band2.setQ(value,time,rampType)},$band2Gain:function(value,time,rampType){this._band2.setGain(value,time,rampType)},$band3Active:function(value){this._band3.toggle(value)},$band3Type:function(value){this._band3.setFilterType(value)},$band3Freq:function(value,time,rampType){this._band3.setFrequency(value,time,rampType)},$band3Q:function(value,time,rampType){this._band3.setQ(value,time,rampType)},$band3Gain:function(value,time,rampType){this._band3.setGain(value,time,rampType)},$band4Active:function(value){this._band4.toggle(value)},$band4Type:function(value){this._band4.setFilterType(value)},$band4Freq:function(value,time,rampType){this._band4.setFrequency(value,time,rampType)},$band4Q:function(value,time,rampType){this._band4.setQ(value,time,rampType)},$band4Gain:function(value,time,rampType){this._band4.setGain(value,time,rampType)}},WX.PlugIn.extendPrototype(EQ4,"Processor"),WX.PlugIn.register(EQ4)}(WX);
!function(WX){"use strict";function FMVoice(synth){this.parent=synth,this.params=synth.params,this.voiceKey=null,this._minDur=null,this._mod=WX.OSC(),this._modGain=WX.Gain(),this._car=WX.OSC(),this._carGain=WX.Gain(),this._mod.to(this._modGain),this._modGain.connect(this._car.frequency),this._car.to(this._carGain).to(this.parent._filter),this._mod2=WX.OSC(),this._modGain2=WX.Gain(),this._car2=WX.OSC(),this._carGain2=WX.Gain(),this._mod2.to(this._modGain2),this._modGain2.connect(this._car2.frequency),this._car2.to(this._carGain2).to(this.parent._filter)}function FMK1(preset){WX.PlugIn.defineType(this,"Generator"),this.numVoice=0,this.voices=[];for(var i=0;128>i;i++)this.voices[i]=[];this._filter=WX.Filter(),this._filter.to(this._output),WX.defineParams(this,{harmonicRatio:{type:"Generic",name:"HRatio","default":4,min:1,max:60},modulationIndex:{type:"Generic",name:"ModIdx","default":1,min:0,max:2},attack:{type:"Generic",name:"Att","default":.005,min:0,max:5,unit:"Seconds"},decay:{type:"Generic",name:"Dec","default":.04,min:0,max:5,unit:"Seconds"},sustain:{type:"Generic",name:"Sus","default":.25,min:0,max:1},release:{type:"Generic",name:"Rel","default":.2,min:0,max:10,unit:"Seconds"},balance:{type:"Generic",name:"Balance","default":.5,min:0,max:1},filterType:{type:"Itemized",name:"FiltType","default":"highshelf",model:WX.FILTER_TYPES},filterFrequency:{type:"Generic",name:"FiltFreq","default":2500,min:20,max:2e4,unit:"Hertz"},filterQ:{type:"Generic",name:"FiltQ","default":0,min:0,max:40},filterGain:{type:"Generic",name:"FiltGain","default":0,min:-40,max:40,unit:"Decibels"}}),WX.PlugIn.initPreset(this,preset)}FMVoice.prototype={noteOn:function(pitch,velocity,time){var p=this.params,freq=WX.mtof(pitch),hr=p.harmonicRatio.get(),mi=p.modulationIndex.get(),att=p.attack.get(),dec=p.decay.get(),sus=p.sustain.get(),bal=p.balance.get(),scale=WX.veltoamp(velocity);this._mod.start(time),this._car.start(time),this._car.frequency.set(freq,time,0),this._mod.frequency.set(freq*hr,time,0),this._modGain.gain.set(freq*hr*mi,time,0),this._modGain.gain.set(.1,time+1.5,2),this._carGain.gain.set(0,time,0),this._carGain.gain.set(scale*bal,time+att,1),this._carGain.gain.set(sus*scale*bal,[time+att,dec],3),this._mod2.start(time),this._car2.start(time),this._car2.frequency.set(2*freq,time,0),this._mod2.frequency.set(freq*hr,time,0),this._modGain2.gain.set(freq*hr*mi*.5,time,0),this._modGain2.gain.set(.5,time+1.5,2),this._carGain2.gain.set(0,time,0),this._carGain2.gain.set(scale*(1-bal),time+att,1),this._carGain2.gain.set(sus*scale*(1-bal),[time+att,dec],3),this.minDur=time+att+dec},noteOff:function(pitch,velocity,time){if(this.minDur){time=time<WX.now?WX.now:time;var p=this.params,rel=p.release.get();this.voiceKey=pitch,this._mod.stop(this.minDur+rel+2),this._car.stop(this.minDur+rel+2),this._mod2.stop(this.minDur+rel+2),this._car2.stop(this.minDur+rel+2),time<this.minDur?(this._carGain.gain.cancel(this.minDur),this._carGain.gain.set(0,[this.minDur,rel],3),this._carGain2.gain.cancel(this.minDur),this._carGain2.gain.set(0,[this.minDur,rel],3)):(this._carGain.gain.set(0,[time,rel],3),this._carGain2.gain.set(0,[time,rel],3))}}},FMK1.prototype={info:{name:"FMK1",version:"0.0.1",api_version:"1.0.0-alpha",author:"Hongchan Choi",type:"Generator",description:"FM Bell-based Keys"},defaultPreset:{harmonicRatio:10,modulationIndex:1.8,attack:.002,decay:.03,sustain:.65,release:.55,balance:.7165,filterType:"highshelf",filterFrequency:7e3,filterQ:0,filterGain:-3,output:.3},$balance:function(){},$filterType:function(value){this._filter.type=value},$filterFrequency:function(value,time,rampType){this._filter.frequency.set(value,time,rampType)},$filterQ:function(value,time,rampType){this._filter.Q.set(value,time,rampType)},$filterGain:function(value,time,rampType){this._filter.gain.set(value,time,rampType)},noteOn:function(pitch,velocity,time){time=time||WX.now;var voice=new FMVoice(this);this.voices[pitch].push(voice),this.numVoice++,voice.noteOn(pitch,velocity,time)},noteOff:function(pitch,velocity,time){time=time||WX.now;for(var playing=this.voices[pitch],i=0;i<playing.length;i++)playing[i].noteOff(pitch,velocity,time),this.numVoice--;this.voices[pitch]=[]},onData:function(action,data){switch(action){case"noteon":this.noteOn(data.pitch,data.velocity);break;case"noteoff":this.noteOff(data.pitch,data.velocity)}}},WX.PlugIn.extendPrototype(FMK1,"Generator"),WX.PlugIn.register(FMK1)}(WX);
!function(WX){function Fader(preset){WX.PlugIn.defineType(this,"Processor"),this._input.to(this._output),WX.defineParams(this,{output:{type:"Generic",name:"Output","default":1,min:0,max:3.9810717055349722,unit:"LinearGain"},mute:{type:"Boolean",name:"Mute","default":!1},dB:{type:"Generic",name:"dB","default":0,min:-60,max:12,unit:"Decibels"}}),WX.PlugIn.initPreset(this,preset)}Fader.prototype={info:{name:"Fader",version:"0.0.3",api_version:"1.0.0-alpha",author:"Hongchan Choi",type:"Processor",description:"Channel Fader"},defaultPreset:{mute:!1,dB:0},$mute:function(value){value?this._outlet.gain.set(0,WX.now,0):this._outlet.gain.set(1,WX.now,0)},$dB:function(value,time,rampType){this.params.output.set(WX.dbtolin(value),time,rampType)}},WX.PlugIn.extendPrototype(Fader,"Processor"),WX.PlugIn.register(Fader),WX.Master=WX.Fader(),WX.Master.to(WX._ctx.destination)}(WX);
!function(WX){"use strict";function FilterBank(preset){WX.PlugIn.defineType(this,"Processor"),this._filters1=[],this._filters2=[],this._gains=[],this._summing=WX.Gain();for(var i=0;NUM_BANDS>i;++i)this._filters1[i]=WX.Filter(),this._filters2[i]=WX.Filter(),this._gains[i]=WX.Gain(),this._filters1[i].type="bandpass",this._filters2[i].type="bandpass",this._input.to(this._filters1[i]),this._filters1[i].to(this._filters2[i]).to(this._gains[i]),this._gains[i].to(this._summing);this._summing.to(this._output),this._summing.gain.value=35,WX.defineParams(this,{pitch:{type:"Generic",name:"Pitch","default":24,min:12,max:48},scale:{type:"Itemized",name:"Scale","default":"lydian",model:SCALES},slope:{type:"Generic",name:"Harmonics","default":.26,min:.1,max:.75},width:{type:"Generic",name:"Width","default":.49,min:0,max:1},detune:{type:"Generic",name:"Detune","default":0,min:0,max:1}}),WX.PlugIn.initPreset(this,preset)}var SCALES=[{key:"Ionian",value:"ionian"},{key:"Lydian",value:"lydian"},{key:"Mixolydian",value:"mixolydian"},{key:"Aeolian",value:"aeolian"}],PITCHES={ionian:[0,7,14,21,28,35,43,48],lydian:[0,6,16,21,26,35,42,48],mixolydian:[0,5,16,23,26,33,41,48],aeolian:[0,7,15,22,26,34,39,48]},NUM_BANDS=8;FilterBank.prototype={info:{name:"FilterBank",version:"0.0.1",api_version:"1.0.0-alpha",author:"Hongchan Choi",type:"Processor",description:"Harmonized 8-band filterbank"},defaultPreset:{pitch:34,scale:"lydian",slope:.65,width:.15,detune:0},$pitch:function(value,time,rampType){for(var f0=WX.mtof(value),i=0;NUM_BANDS>i;i++)this._filters1[i].frequency.set(f0,time,rampType),this._filters2[i].frequency.set(f0,time,rampType)},$scale:function(value,time,rampType){time=WX.now||time;for(var pitches=PITCHES[value],i=1;NUM_BANDS>i;i++)this._filters1[i].detune.set(100*pitches[i],time,rampType),this._filters2[i].detune.set(100*pitches[i],time,rampType)},$slope:function(value,time,rampType){for(var i=0;NUM_BANDS>i;i++){var gain=1+Math.sin(Math.PI+Math.PI/2*(value+i/NUM_BANDS));this._gains[i].gain.set(gain,time,rampType)}},$width:function(value,time,rampType){for(var i=1;NUM_BANDS>i;i++){var q=2+90*Math.pow(1-i/NUM_BANDS,value);this._filters1[i].Q.set(q,time,rampType),this._filters2[i].Q.set(q,time,rampType)}},$detune:function(){},getScaleModel:function(){return SCALES.slice(0)}},WX.PlugIn.extendPrototype(FilterBank,"Processor"),WX.PlugIn.register(FilterBank)}(WX);
!function(WX){"use strict";function Impulse(preset){WX.PlugIn.defineType(this,"Generator"),this._impulse=WX.OSC(),this._impulse.to(this._output),this._impulse.start(0),this._impulse.setPeriodicWave(DATA),WX.defineParams(this,{freq:{type:"Generic",name:"Freq","default":1,min:.1,max:60,unit:"Hertz"}}),WX.PlugIn.initPreset(this,preset)}for(var binSize=2048,mag=new Float32Array(binSize),phase=new Float32Array(binSize),i=0;binSize>i;++i)mag[i]=1,phase[i]=0;var DATA=WX.PeriodicWave(mag,phase);Impulse.prototype={info:{name:"Impulse",version:"0.0.1",api_version:"1.0.0-alpha",author:"Hongchan Choi",type:"Generator",description:"Impulse (train) Generator"},defaultPreset:{freq:1},$freq:function(value,time,rampType){this._impulse.frequency.set(value,time,rampType)}},WX.PlugIn.extendPrototype(Impulse,"Generator"),WX.PlugIn.register(Impulse)}(WX);
!function(WX){"use strict";function createGaussian(duration){for(var length=Math.floor(WX.srate*duration),noiseFloat32=new Float32Array(length),i=0;length>i;i++){var r1=Math.log(Math.random()),r2=Math.PI*Math.random();noiseFloat32[i]=Math.sqrt(-2*r1)*Math.cos(2*r2)*.5}var noiseBuffer=WX.Buffer(2,length,WX.srate);return noiseBuffer.getChannelData(0).set(noiseFloat32,0),noiseBuffer.getChannelData(1).set(noiseFloat32,0),noiseBuffer}function createPink(duration){for(var length=Math.floor(WX.srate*duration),noiseFloat32=new Float32Array(length),pA=[3.8024,2.9694,2.597,3.087,3.4006],pSum=[.00198,.01478,.06378,.23378,.91578],pASum=15.8564,sample=0,contrib=[0,0,0,0,0],i=0;length>i;i++){for(var ur1=Math.random(),ur2=Math.random(),j=0;5>j;j++)if(ur1<=pSum[j]){sample-=contrib[j],contrib[j]=2*(ur2-.5)*pA[j],sample+=contrib[j];break}noiseFloat32[i]=sample/pASum}var noiseBuffer=WX.Buffer(2,length,WX.srate);return noiseBuffer.getChannelData(0).set(noiseFloat32,0),noiseBuffer.getChannelData(1).set(noiseFloat32,0),noiseBuffer}function Noise(preset){WX.PlugIn.defineType(this,"Generator"),this._bufferGaus=createGaussian(9.73),this._bufferPink=createPink(9.73),this._src1=WX.Source(),this._src2=WX.Source(),this._src1.to(this._output),this._src2.to(this._output),this._src1.loop=!0,this._src2.loop=!0,this._src1.start(0),this._src2.start(0),WX.defineParams(this,{type:{type:"Itemized",name:"Type","default":"white",model:NOISETYPE}}),WX.PlugIn.initPreset(this,preset)}var NOISETYPE=[{key:"White",value:"white"},{key:"Pink",value:"pink"}],_baseBufferGaus=createGaussian(10),_baseBufferPink=createPink(10);Noise.prototype={info:{name:"Noise",version:"0.0.1",api_version:"1.0.0-alpha",author:"Hongchan Choi",type:"Generator",description:"White and Pink Noise Generator"},defaultPreset:{type:"white"},$type:function(value){switch(value){case"white":this._src1.buffer=_baseBufferGaus,this._src2.buffer=this._bufferGaus,this._src1.loopStart=10*Math.random();break;case"pink":this._src1.buffer=_baseBufferPink,this._src2.buffer=this._bufferPink,this._src1.loopStart=10*Math.random()}}},WX.PlugIn.extendPrototype(Noise,"Generator"),WX.PlugIn.register(Noise)}(WX);
!function(WX){"use strict";function SP1Voice(sampler){this.parent=sampler,this.params=sampler.params,this.voiceKey=null,this.minDur=null,this._src=WX.Source(),this._srcGain=WX.Gain(),this._src.to(this._srcGain).to(this.parent._filter),this._src.loop=!0,this._src.buffer=this.parent.clip.buffer}function SP1(preset){WX.PlugIn.defineType(this,"Generator"),this.ready=!1,this.clip=null,this.numVoice=0,this.voices=[];for(var i=0;128>i;i++)this.voices[i]=[];this._filter=WX.Filter(),this._filter.to(this._output),WX.defineParams(this,{tune:{type:"Generic",name:"Tune","default":48,min:0,max:127,unit:"Semitone"},pitchMod:{type:"Boolean",name:"PitchMod","default":!0},velocityMod:{type:"Boolean",name:"VeloMod","default":!0},ampAttack:{type:"Generic",name:"Att","default":.02,min:0,max:5,unit:"Seconds"},ampDecay:{type:"Generic",name:"Dec","default":.04,min:0,max:5,unit:"Seconds"},ampSustain:{type:"Generic",name:"Sus","default":.25,min:0,max:1,unit:"LinearGain"},ampRelease:{type:"Generic",name:"Rel","default":.2,min:0,max:10,unit:"Seconds"},filterType:{type:"Itemized",name:"FiltType","default":"lowpass",model:WX.FILTER_TYPES},filterFrequency:{type:"Generic",name:"FiltFreq","default":2500,min:20,max:2e4,unit:"Hertz"},filterQ:{type:"Generic",name:"FiltQ","default":0,min:0,max:40},filterGain:{type:"Generic",name:"FiltGain","default":0,min:-40,max:40,unit:"LinearGain"}}),WX.PlugIn.initPreset(this,preset)}SP1Voice.prototype={noteOn:function(pitch,velocity,time){var p=this.params,basePitch=p.tune.get(),att=p.ampAttack.get(),dec=p.ampDecay.get(),sus=p.ampSustain.get(),scale=p.velocityMod.get()?WX.veltoamp(velocity):1;p.pitchMod.get()&&(this._src.playbackRate.value=Math.pow(2,(pitch-basePitch)/12)),this._src.start(time),this._srcGain.gain.set(0,time,0),this._srcGain.gain.set(scale,time+att,1),this._srcGain.gain.set(sus*scale,[time+att,dec],3),this.minDur=time+att+dec},noteOff:function(pitch,velocity,time){if(this.minDur){time=time<WX.now?WX.now:time;var p=this.params,rel=p.ampRelease.get();this.voiceKey=pitch,this._src.stop(this.minDur+rel+1),time<this.minDur?(this._srcGain.gain.cancel(this.minDur),this._srcGain.gain.set(0,[this.minDur,rel],3)):this._srcGain.gain.set(0,[time,rel],3)}}},SP1.prototype={info:{name:"SP1",version:"0.0.1",api_version:"1.0.0-alpha",author:"Hongchan Choi",type:"Generator",description:"Versatile Single-Zone Sampler"},defaultPreset:{tune:60,pitchMod:!0,velocityMod:!0,ampAttack:.01,ampDecay:.44,ampSustain:.06,ampRelease:.06,filterType:"LP",filterFrequency:5e3,filterQ:0,filterGain:0,output:1},$filterType:function(value){this._filter.type=value},$filterFrequency:function(value,time,rampType){this._filter.frequency.set(value,time,rampType)},$filterQ:function(value,time,rampType){this._filter.Q.set(value,time,rampType)},$filterGain:function(value,time,rampType){this._filter.gain.set(value,time,rampType)},noteOn:function(pitch,velocity,time){time=time||WX.now;var voice=new SP1Voice(this);this.voices[pitch].push(voice),this.numVoice++,voice.noteOn(pitch,velocity,time)},noteOff:function(pitch,velocity,time){time=time||WX.now;for(var playing=this.voices[pitch],i=0;i<playing.length;i++)playing[i].noteOff(pitch,velocity,time),this.numVoice--;this.voices[pitch]=[]},onData:function(action,data){switch(action){case"noteon":this.noteOn(data.pitch,data.velocity);break;case"noteoff":this.noteOff(data.pitch,data.velocity)}},_onprogress:function(){},_onloaded:function(clip){this.setClip(clip),WX.Log.info("Clip loaded:",clip.name)},onReady:null,isReady:function(){return this.ready},setClip:function(clip){this.clip=clip,this.ready=!0,this.onReady&&this.onReady()},loadClip:function(clip){WX.loadClip(clip,this._onloaded.bind(this),this._onprogress.bind(this))}},WX.PlugIn.extendPrototype(SP1,"Generator"),WX.PlugIn.register(SP1)}(WX);
!function(WX){"use strict";function SimpleOsc(preset){WX.PlugIn.defineType(this,"Generator"),this._lfo=WX.OSC(),this._lfoGain=WX.Gain(),this._osc=WX.OSC(),this._amp=WX.Gain(),this._osc.to(this._amp).to(this._output),this._lfo.to(this._lfoGain).to(this._osc.detune),this._lfo.start(0),this._osc.start(0),this._amp.gain.value=0,WX.defineParams(this,{oscType:{type:"Itemized",name:"Waveform","default":"sine",model:WX.WAVEFORMS},oscFreq:{type:"Generic",name:"Freq","default":WX.mtof(60),min:20,max:5e3,unit:"Hertz"},lfoType:{type:"Itemized",name:"LFO Type","default":"sine",model:WX.WAVEFORMS},lfoRate:{type:"Generic",name:"Rate","default":1,min:0,max:20,unit:"Hertz"},lfoDepth:{type:"Generic",name:"Depth","default":1,min:0,max:500,unit:"LinearGain"}}),WX.PlugIn.initPreset(this,preset)}SimpleOsc.prototype={info:{name:"SimpleOsc",version:"0.0.2",api_version:"1.0.0-alpha",author:"Hongchan Choi",type:"Generator",description:"1 OSC with LFO"},defaultPreset:{oscType:"sine",oscFreq:WX.mtof(60),lfoType:"sine",lfoRate:1,lfoDepth:1},$oscType:function(value){this._osc.type=value},$oscFreq:function(value,time,rampType){this._osc.frequency.set(value,time,rampType)},$lfoType:function(value){this._lfo.type=value},$lfoRate:function(value,time,rampType){this._lfo.frequency.set(value,time,rampType)},$lfoDepth:function(value,time,rampType){this._lfoGain.gain.set(value,time,rampType)},noteOn:function(pitch,velocity,time){time=time||WX.now,this._amp.gain.set(velocity/127,[time,.02],3),this.params.oscFreq.set(WX.mtof(pitch),time+.02,0)},noteOff:function(time){time=time||WX.now,this._amp.gain.set(0,[time,.2],3)},onData:function(action,data){switch(action){case"noteon":this.noteOn(data.pitch,data.velocity);break;case"noteoff":this.noteOff()}}},WX.PlugIn.extendPrototype(SimpleOsc,"Generator"),WX.PlugIn.register(SimpleOsc)}(WX);
!function(WX){"use strict";function StereoDelay(preset){WX.PlugIn.defineType(this,"Processor"),this._lDelay=WX.Delay(),this._rDelay=WX.Delay(),this._lFeedback=WX.Gain(),this._rFeedback=WX.Gain(),this._lXtalk=WX.Gain(),this._rXtalk=WX.Gain(),this._dry=WX.Gain(),this._wet=WX.Gain();var _splitter=WX.Splitter(2),_merger=WX.Merger(2);this._input.to(_splitter,this._dry),_splitter.connect(this._lDelay,0),this._lDelay.to(this._lFeedback),this._lFeedback.to(this._lDelay,this._rXtalk),this._lXtalk.to(this._lDelay),this._lDelay.connect(_merger,0,0),_splitter.connect(this._rDelay,0),this._rDelay.to(this._rFeedback),this._rFeedback.to(this._rDelay,this._lXtalk),this._rXtalk.to(this._rDelay),this._rDelay.connect(_merger,0,1),_merger.to(this._wet),this._dry.to(this._output),this._wet.to(this._output),WX.defineParams(this,{delayTimeLeft:{type:"Generic",name:"L Delay","default":.125,min:.025,max:5,unit:"Seconds"},delayTimeRight:{type:"Generic",name:"R Delay","default":.25,min:.025,max:5,unit:"Seconds"},feedbackLeft:{type:"Generic",name:"L FB","default":.25,min:0,max:1},feedbackRight:{type:"Generic",name:"R FB","default":.125,min:0,max:1},crosstalk:{type:"Generic",name:"Crosstalk","default":.1,min:0,max:1},mix:{type:"Generic",name:"Mix","default":.2,min:0,max:1}}),WX.PlugIn.initPreset(this,preset)}StereoDelay.prototype={info:{name:"StereoDelay",version:"0.0.3",api_version:"1.0.0-alpha",author:"Hongchan Choi",type:"Processor",description:"Pingpong Delay with Feedback Control"},defaultPreset:{delayTimeLeft:.125,delayTimeRight:.25,feedbackLeft:.25,feedbackRight:.125,crosstalk:.1,mix:.2},$delayTimeLeft:function(value,time,rampType){this._lDelay.delayTime.set(value,time,rampType)},$delayTimeRight:function(value,time,rampType){this._rDelay.delayTime.set(value,time,rampType)},$feedbackLeft:function(value,time,rampType){this._lFeedback.gain.set(value,time,rampType)},$feedbackRight:function(value,time,rampType){this._rFeedback.gain.set(value,time,rampType)},$crosstalk:function(value,time,rampType){this._lXtalk.gain.set(value,time,rampType),this._rXtalk.gain.set(value,time,rampType)},$mix:function(value,time,rampType){this._dry.gain.set(1-value,time,rampType),this._wet.gain.set(value,time,rampType)}},WX.PlugIn.extendPrototype(StereoDelay,"Processor"),WX.PlugIn.register(StereoDelay)}(WX);
!function(WX){"use strict";function WXS1(preset){WX.PlugIn.defineType(this,"Generator"),this._osc1=WX.OSC(),this._osc2=WX.OSC(),this._osc1gain=WX.Gain(),this._osc2gain=WX.Gain(),this._lowpass=WX.Filter(),this._amp=WX.Gain(),this._osc1.to(this._osc1gain).to(this._lowpass),this._osc2.to(this._osc2gain).to(this._lowpass),this._lowpass.to(this._amp),this._amp.to(this._output),this._osc1.start(0),this._osc2.start(0),this._amp.gain.value=0,this._pitchTimeStamps={},WX.defineParams(this,{osc1type:{type:"Itemized",name:"Waveform","default":"square",model:WX.WAVEFORMS},osc1octave:{type:"Generic",name:"Octave","default":0,min:-5,max:5,unit:"Octave"},osc1gain:{type:"Generic",name:"Gain","default":.5,min:0,max:1,unit:"LinearGain"},osc2type:{type:"Itemized",name:"Waveform","default":"square",model:WX.WAVEFORMS},osc2detune:{type:"Generic",name:"Semitone","default":0,min:-60,max:60,unit:"Semitone"},osc2gain:{type:"Generic",name:"Gain","default":.5,min:0,max:1,unit:"LinearGain"},glide:{type:"Generic",name:"Glide","default":.02,min:.006,max:1,unit:"Seconds"},cutoff:{type:"Generic",name:"Cutoff","default":1e3,min:20,max:5e3,unit:"Hertz"},reso:{type:"Generic",name:"Reso","default":0,min:0,max:20,unit:""},filterMod:{type:"Generic",name:"FiltMod","default":1,min:.25,max:8,unit:""},filterAttack:{type:"Generic",name:"FiltAtt","default":.02,min:0,max:5,unit:"Seconds"},filterDecay:{type:"Generic",name:"FiltDec","default":.04,min:0,max:5,unit:"Seconds"},filterSustain:{type:"Generic",name:"FiltSus","default":.25,min:0,max:1},filterRelease:{type:"Generic",name:"FiltRel","default":.2,min:0,max:10,unit:"Seconds"},ampAttack:{type:"Generic",name:"Att","default":.02,min:0,max:5,unit:"Seconds"},ampDecay:{type:"Generic",name:"Dec","default":.04,min:0,max:5,unit:"Seconds"},ampSustain:{type:"Generic",name:"Sus","default":.25,min:0,max:1},ampRelease:{type:"Generic",name:"Rel","default":.2,min:0,max:10,unit:"Seconds"}}),WX.PlugIn.initPreset(this,preset)}WXS1.prototype={info:{name:"WXS1",version:"0.0.3",api_version:"1.0.0-alpha",author:"Hongchan Choi",type:"Generator",description:"2 OSC Monophonic Subtractive Synth"},defaultPreset:{osc1type:"square",osc1octave:-1,osc1gain:.4,osc2type:"square",osc2detune:7,osc2gain:.4,glide:.02,cutoff:140,reso:18,filterMod:7,filterAttack:.01,filterDecay:.07,filterSustain:.5,filterRelease:.03,ampAttack:.01,ampDecay:.44,ampSustain:.2,ampRelease:.06,output:.8},$osc1type:function(value){this._osc1.type=value},$osc1octave:function(value,time,rampType){this._osc1.detune.set(1200*value,time,rampType)},$osc1gain:function(value,time,rampType){this._osc1gain.gain.set(value,time,rampType)},$osc2type:function(value){this._osc2.type=value},$osc2detune:function(value,time,rampType){this._osc2.detune.set(100*value,time,rampType)},$osc2gain:function(value,time,rampType){this._osc2gain.gain.set(value,time,rampType)},$cutoff:function(value,time,rampType){this._lowpass.frequency.set(value,time,rampType)},$reso:function(value,time,rampType){this._lowpass.Q.set(value,time,rampType)},_getCurrentPitch:function(){var latestPitch=null,latestTimeStamp=0;for(var pitch in this._pitchTimeStamps){var timeStamp=this._pitchTimeStamps[pitch];timeStamp>latestTimeStamp&&(latestTimeStamp=timeStamp,latestPitch=pitch)}return latestPitch},_changePitch:function(pitch,time){time=(time||WX.now)+this.params.glide.get();var freq=WX.mtof(pitch);this._osc1.frequency.set(freq,time,1),this._osc2.frequency.set(freq,time,1)},_startEnvelope:function(time){time=time||WX.now;var p=this.params,aAtt=p.ampAttack.get(),aDec=p.ampDecay.get(),fAmt=1200*p.filterMod.get(),fAtt=p.filterAttack.get(),fDec=p.filterDecay.get(),fSus=p.filterSustain.get();this._amp.gain.set(1,[time,aAtt],3),this._lowpass.detune.set(fAmt,[time,fAtt],3),this._amp.gain.set(fSus,[time+aAtt,aDec],3),this._lowpass.detune.set(fAmt*fSus,[time+fAtt,fDec],3)},_releaseEnvelope:function(time){time=time||WX.now;var p=this.params;this._amp.gain.cancel(time),this._lowpass.detune.cancel(time),this._amp.gain.set(0,[time,p.ampRelease.get()],3),this._lowpass.detune.set(0,[time,p.filterRelease.get()],3)},onData:function(action,data){switch(action){case"noteon":this._pitchTimeStamps[data.pitch]=data.time;var pitch=this._getCurrentPitch();1===Object.keys(this._pitchTimeStamps).length?(this._changePitch(pitch,data.time),this._startEnvelope(data.time)):this._changePitch(pitch,data.time);break;case"noteoff":this._pitchTimeStamps.hasOwnProperty(data.pitch)&&delete this._pitchTimeStamps[data.pitch];var pitch=this._getCurrentPitch();null===pitch?this._releaseEnvelope(data.time):this._changePitch(pitch,data.time)}}},WX.PlugIn.extendPrototype(WXS1,"Generator"),WX.PlugIn.register(WXS1)}(WX);