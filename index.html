<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no">
    <title>synestizer</title>

    <link href='https://fonts.googleapis.com/css?family=Roboto+Condensed' rel='stylesheet' type='text/css'>

    <!-- synestizer style -->
    <link rel="stylesheet" href="css/style.css">

</head>

<body>

    <div id="wrapper">
        <section id="app">
            <canvas id="canvas"></canvas>

            <video id="video" muted autoplay></video>

            <h1 id="logo">SYNESTIZER BETA</h1>

            <div class="row full">

                <div id="info" class="large-12 large-centered columns hide text-center">
                    <h1 class="info-title">
                        Welcome to Synestizer.
                    </h1>

                    <p class="info-text">
                        Please enable your webcam in the browser and activate your loudspeakers.
                    </p>
                </div>


                                <a href="#rgb-panel">RGB</a>

                                <div id="rgb-panel" class="content active">
                                    <button onclick="document.getElementById('wrapper').webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT);">fullscreen</button>
                                    <div id="average-bars"></div>
                                </div>

                                <a href="#dominant-panel">Dominant Color</a>

                                <div id="dominant-panel" class="content active">
                                    <div id="dominant-bars"></div>
                                </div>

        </section>

        <!-- Footer -->
        <div id="footer">
            <div class="footer_content">
                &copy; 2015 by <a href="http://www.kasparkoenig.com/">kaspar</a>,
                <a href="https://www.livingthing.org">dan</a> &amp;
                <a href="http://www.stahlnow.com">stahl</a>.
                This work is licensed under a <a rel="license"
                href="http://creativecommons.org/licenses/by-sa/4.0/">Creative
                Commons Attribution-ShareAlike 4.0 International License</a>.</p>
            </div>
        </div>
    </div>
    <script src="./bower_components/pubsub.js/src/pubsub.js"></script>
    <script src="./bower_components/d3/d3.js"></script>
    <script src="js/vendor/waax.js"></script>    
    
    <!-- our stuff -->
    <script src="./js/video/analyzer.js"></script>
    <script src="./js/video/videostats.js"></script>
    <script src="./js/video/mapping.js"></script>
    <script src="./js/audio/patches/minimal.js"></script>
    <script src="./js/audio/patches/triad.js"></script>
    <script src="./js/audio/synths/SP1.js"></script>
    <script src="./js/audio/synths/triad.js"></script>
    <script>
      var analyzer, pubsub, handle, bars, scale, graph;
      pubsub = PubSub; //give our global signal bus a nice name
      window.addEventListener('DOMContentLoaded', function() {
        analyzer = new this.videoanalyzers.VideoAnalyzer({
          vidElem: document.getElementById('v'),
          canvElem: document.getElementById('c'),
          statistics: [new this.videostatistics.DominantColor()],
          pubsub: pubsub,
        });
        graph = d3.select("#s");
        scale = d3.scale.linear()
          .domain([0, 1])
          .range([0, 100]); //could be determined from style
        handle = pubsub.subscribe(
          "/videoanalyzer/dominantcolor/raw", function(data){
              bars = graph.selectAll("div").data(data);
              bars.enter().append("div");
              bars.style("width", function(d) { return scale(d) + "px"; });
              bars.exit().remove();
        });
      });
    </script>
    <!-- include WAAX -->
    <script src="js/vendor/waax.js"></script>    

</body>
</html>